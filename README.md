# chat-service
동일한 채팅 서비스를 Spring MVC와 WebFlux 방식으로 각각 구현하여, 성능 및 처리 방식의 차이를 비교한다.
또한, 성능 테스트를 통해 JVM의 주요 리소스 사용 현황을 자세히 파악하고, 중요한 지표들을 분석한다.

<pre><code>```
[chat-react]
    └── 간단한 채팅 클라이언트 (React 기반)

[chat-bot]
    └── 시뮬레이션용 부하 테스트 봇 (채팅 생성기)

[chat-mvc]
    └── Spring Boot MVC + Tomcat 기반 채팅 서버

[chat-webflux]
    └── Spring Boot WebFlux + Netty 기반 채팅 서버

[chat-monitoring]
    └── Prometheus, Grafana 등 모니터링 설정
``` </code></pre>


# 프로젝트 개요
WebSocket 기반의 간단한 채팅 기능을 두 가지 방식(MVC와 WebFlux)으로 구현하였다. 이후 가상의 클라이언트인  
chat-bot를 통해 시뮬레이션 부하를 발생시키고 Prometheus, Grafana 등 모니터링 도구로 성능 및 안정성을 측정한다.  

모니터링 하고자 하는 지표는 아래와 같다.  

| 항목           | 설명                                      |
|----------------|-------------------------------------------|
| 메시지 처리량   | 초당 처리 가능한 메시지 수 (TPS)          |
| 응답 속도       | 평균 / 최대 지연 시간                    |
| 리소스 사용량   | CPU, 메모리, GC 시간 등                     |
| 메시지 유실률   | 전송 대비 수신 누락 비율                  |
| 최대 접속자 수  | 서버가 안정적으로 처리 가능한 동시 접속 수 |


### 채팅 어플리케이션 기능
* 아이디만 입력하여 채팅 서버로 입장
    * 사용자 입장은 REST API (단발성 요청)
* 채팅방 생성, 조회, 입장, 퇴장
    * 채팅방 목록 조회, 생성은 REST API, 채팅방 생성 알림은 WebSocket
    * 채팅방 입장은 REST API, 입장 알림은 시스템 메시지로 구독
    * 채팅방 퇴장은 REST API, 퇴장 알림은 시스템 메시지로 구독
    * 채팅방 입장, 퇴장은 채팅방에 인원에 영향을 주지는 않고 채팅창을 보고 있는지 없는지 정도 구분 용도
    * 채팅방에서 WebSocket 연결이 끊긴 경우에 퇴장 처리(서버에서 Disconnect 감지 후 처리)
* 1:1 또는 그룹 채팅 기능
    * 메시지 송신/수신은 WebSocket을 통해 처리
    * 송신: 사용자 메시지 입력 / 수신: 메시지, 입장/퇴장 알림


### 채팅 웹 클라이언트 화면 시연



### 성능테스트 결과
MVC와 WebFlux 웹 서버는 성능 비교의 정확도를 높이기 위해 동일한 자원 제약 조건하에 실행하였다.  
이렇게 리소스 자원을 제한하므로써 어느 환경에서 테스트하더라도 결과를 일관되게 만들 수 있다고 판단하였다.  
Windows 기반 Docker 환경에서는 Linux 커널 수준의 I/O 및 트래픽 제어 기능(sch_netem, blkio 등)이  
직접 지원되지 않기 때문에 제한 설정에 어려움이 있었다.  

Docker 컨테이너의 리소스 설정은 다음과 같다. 자세한 내용은 MVC 프로젝트의 README를 참고하면 된다.
- cpus: "0.5"
- 메모리: 512M
- 디스크: 호스트 OS가 Window11 환경이다보니 디스크 크기나 I/O 속도를 제한하는데 제약이 있었다.
- 네트워크 대역폭: tc를 사용하여 네트워크 속도를 제한하려 했으나 호스트 OS가 Window11이라 적용하지 못했다.